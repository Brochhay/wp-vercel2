// pages/api/post.js
export default async function handler(req, res) {
    const { slug } = req.query;
    
    if (!slug) {
        return res.status(400).json({ error: "Missing post slug" });
    }

    const GRAPHQL_ENDPOINT = process.env.GRAPHQL_ENDPOINT || "https://freshnew.online/graphql";
    
    const query = `
        query GetPostBySlug($slug: String!) {
            postBy(slug: $slug) {
                title
                content
                date
                author {
                    node {
                        name
                    }
                }
            }
        }
    `;

    const variables = { slug };

    try {
        const response = await fetch(GRAPHQL_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query, variables })
        });

        const json = await response.json();

        if (json.errors) {
            return res.status(500).json({ error: json.errors });
        }

        return res.status(200).json(json.data.postBy);
    } catch (error) {
        return res.status(500).json({ error: "Failed to fetch post" });
    }
}

